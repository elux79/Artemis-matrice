<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Art√©mis Simulateur - D√©cisions Firme 3</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;margin:0;padding:20px;background:#f8f9fa;color:#212529}
.header{background:linear-gradient(135deg,#007bff,#0056b3);color:white;padding:20px;border-radius:8px;margin-bottom:20px}
.header h1{margin:0;font-size:24px}
.subtitle{opacity:0.9;margin-top:5px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
.card{background:white;border:1px solid #dee2e6;border-radius:8px;padding:20px;box-shadow:0 2px 4px rgba(0,0,0,0.1)}
.card h2{font-size:18px;margin:0 0 15px;color:#495057;border-bottom:2px solid #007bff;padding-bottom:8px}
.card h3{font-size:14px;margin:15px 0 8px;color:#6c757d;text-transform:uppercase;font-weight:600}
.row{display:flex;gap:10px;align-items:center;margin:6px 0}
.row label{flex:1;font-size:13px}
.row input,.row select{width:120px;padding:6px 8px;border:1px solid #ced4da;border-radius:4px;font-size:13px}
.row input:focus,.row select:focus{border-color:#007bff;outline:none;box-shadow:0 0 0 2px rgba(0,123,255,0.25)}
.results{font-family:'Courier New',monospace;font-size:12px;line-height:1.4;background:#f8f9fa;padding:15px;border-radius:4px;white-space:pre-line}
.validation{background:#d4edda;border:1px solid #c3e6cb;padding:15px;border-radius:4px;margin-top:15px}
.validation.error{background:#f8d7da;border-color:#f5c6cb}
.validation.simulation{background:#d1ecf1;border-color:#bee5eb}
.ok{color:#155724;font-weight:bold}
.error{color:#721c24;font-weight:bold}
.info{color:#0c5460;font-weight:bold}
.warn{background:#fff3cd;border:1px solid:#ffeaa7;padding:10px;border-radius:4px;margin:10px 0;font-size:12px}
</style>
</head>
<body>

<div class="header">
  <h1>Art√©mis Simulateur - D√©cisions Firme 3</h1>
  <div class="subtitle">Validation P0 / Simulation P1+ avec imp√¥ts dynamiques</div>
</div>

<div class="grid">
  <div class="card">
    <h2>üìä D√©cisions Firme 3</h2>
    
    <h3>Mode de Calcul</h3>
    <div class="row">
      <label>P√©riode de simulation</label>
      <select id="mode_periode">
        <option value="P0">P0 - Validation (-203 K‚Ç¨)</option>
        <option value="P1">P1+ - Simulation (IS 32%)</option>
      </select>
    </div>
    
    <h3>Produit Silis</h3>
    <div class="row"><label>Prix de vente (‚Ç¨)</label><input id="prix_silis" type="number" step="1" value="530"></div>
    <div class="row"><label>Investissement communication (k‚Ç¨)</label><input id="com_silis" type="number" step="1" value="3000"></div>
    <div class="row"><label>Investissement qualit√© (k‚Ç¨)</label><input id="qual_silis" type="number" step="1" value="3000"></div>
    <div class="row"><label>Investissement d√©veloppement durable (k‚Ç¨)</label><input id="dd_silis" type="number" step="1" value="1000"></div>
    <div class="row"><label>Effort commercial (k‚Ç¨)</label><input id="effort_silis" type="number" step="1" value="4000"></div>

    <h3>Produit Exolis</h3>
    <div class="row"><label>Prix de vente (‚Ç¨)</label><input id="prix_exolis" type="number" step="1" value="0"></div>
    <div class="row"><label>Investissement communication (k‚Ç¨)</label><input id="com_exolis" type="number" step="1" value="0"></div>
    <div class="row"><label>Investissement qualit√© (k‚Ç¨)</label><input id="qual_exolis" type="number" step="1" value="0"></div>
    <div class="row"><label>Investissement d√©veloppement durable (k‚Ç¨)</label><input id="dd_exolis" type="number" step="1" value="0"></div>
    <div class="row"><label>Effort commercial (k‚Ç¨)</label><input id="effort_exolis" type="number" step="1" value="0"></div>

    <h3>Investissement</h3>
    <div class="row"><label>Investissement en d√©veloppement humain (k‚Ç¨)</label><input id="idh" type="number" step="1" value="600"></div>

    <h3>Usine Stand</h3>
    <div class="row"><label>Nombre d'usines achet√©es</label><input id="achat_stand" type="number" step="1" value="0"></div>
    <div class="row"><label>Nombre d'usines vendues</label><input id="vente_stand" type="number" step="1" value="0"></div>
    <div class="row"><label>Nombre d'usines effectives</label><input id="n_stand" type="number" step="1" value="10"></div>
    <div class="row"><label>Investissement en R&amp;D (k‚Ç¨)</label><input id="rd_stand" type="number" step="1" value="2000"></div>

    <h3>Usine Green</h3>
    <div class="row"><label>Nombre d'usines achet√©es</label><input id="achat_green" type="number" step="1" value="0"></div>
    <div class="row"><label>Nombre d'usines vendues</label><input id="vente_green" type="number" step="1" value="0"></div>
    <div class="row"><label>Nombre d'usines effectives</label><input id="n_green" type="number" step="1" value="0"></div>
    <div class="row"><label>Investissement en R&amp;D (k‚Ç¨)</label><input id="rd_green" type="number" step="1" value="0"></div>

    <h3>Production</h3>
    <div class="row"><label><strong>Achat de MP (hors contrat)</strong></label><input disabled style="opacity:0.6" value="‚Äî"></div>
    <div class="row"><label>MP Stand (unit√©s)</label><input id="mp_stand" type="number" step="1" value="100000"></div>
    <div class="row"><label>MP Green (unit√©s)</label><input id="mp_green" type="number" step="1" value="0"></div>
    <div class="row"><label>Produit Silis : Nombre d'unit√©s produites</label><input id="prod_silis" type="number" step="1" value="100000"></div>
    <div class="row"><label>Produit Silis : % de MP Green</label><input id="pct_green_silis" type="number" step="0.1" value="0"></div>
    <div class="row"><label>Produit Exolis : Nombre d'unit√©s produites</label><input id="prod_exolis" type="number" step="1" value="0"></div>
    <div class="row"><label>Produit Exolis : % de MP Green</label><input id="pct_green_exolis" type="number" step="0.1" value="50"></div>

    <h3>Finance</h3>
    <div class="row"><label>Emprunt court terme (1 trimestre) (k‚Ç¨)</label><input id="emprunt_ct" type="number" step="1" value="0"></div>
    <div class="row"><label>Emprunt long terme (6 trimestres) (k‚Ç¨)</label><input id="emprunt_lt" type="number" step="1" value="0"></div>
    <div class="row"><label>Escompte client (%)</label><input id="escompte_client" type="number" step="0.1" value="0"></div>
    <div class="row"><label>Effets escompt√©s bancaires (k‚Ç¨)</label><input id="effets_escomptes" type="number" step="1" value="0"></div>
  </div>

  <div class="card">
    <h2>üí∞ Compte de R√©sultat</h2>
    <div id="compte_resultat" class="results"></div>
    
    <div id="validation_gate"></div>
  </div>
</div>

<script>
// Fonctions utilitaires
function formatNumber(x) { return Math.round(x).toLocaleString('fr-FR') }

function getChargesAdmin(nbUsines) {
  if (nbUsines <= 6) return 1000 + 100 * nbUsines
  if (nbUsines <= 21) return 2000 + 100 * nbUsines
  return 3000 + 100 * nbUsines
}

function getTauxStockagePF(ratio) {
  if (ratio <= 1) return 0.02
  if (ratio <= 2) return 0.03
  if (ratio <= 3) return 0.04
  return 0.07
}

function recalculer() {
  // Constantes P0 pour validation exacte
  const P0_VENTES_SILIS = 85000
  const P0_STOCK_INITIAL_U = 65000
  const P0_STOCK_INITIAL_PU = 362.30
  const P0_VENTES_PREV = 100000
  const P0_STOCK_MP_PREV = 8926
  const P0_ENCOURS_LT = 26250
  const P0_MP_COUT_UNITAIRE = 179.51

  // Lecture des inputs
  const mode_periode = document.getElementById('mode_periode').value
  const prix_silis = +document.getElementById('prix_silis').value
  const com_silis = +document.getElementById('com_silis').value
  const qual_silis = +document.getElementById('qual_silis').value
  const dd_silis = +document.getElementById('dd_silis').value
  const effort_silis = +document.getElementById('effort_silis').value
  const prix_exolis = +document.getElementById('prix_exolis').value
  const com_exolis = +document.getElementById('com_exolis').value
  const qual_exolis = +document.getElementById('qual_exolis').value
  const dd_exolis = +document.getElementById('dd_exolis').value
  const effort_exolis = +document.getElementById('effort_exolis').value
  const idh = +document.getElementById('idh').value
  const n_stand = +document.getElementById('n_stand').value
  const n_green = +document.getElementById('n_green').value
  const rd_stand = +document.getElementById('rd_stand').value
  const rd_green = +document.getElementById('rd_green').value
  const prod_silis = +document.getElementById('prod_silis').value
  const prod_exolis = +document.getElementById('prod_exolis').value

  // === CALCULS COMPTE DE R√âSULTAT ===
  
  const nbUsines = n_stand + n_green
  
  // 1. Chiffre d'affaires
  const ca_silis = (prix_silis * P0_VENTES_SILIS) / 1000
  const ca_exolis = (prix_exolis * 0) / 1000 // Pas de ventes Exolis en P0
  const ca_total = ca_silis + ca_exolis
  
  // 2. Co√ªt de production
  const mp_consommees = (P0_MP_COUT_UNITAIRE * prod_silis) / 1000
  const mp_consommees_exolis = (280 * prod_exolis) / 1000
  const mp_total = mp_consommees + mp_consommees_exolis
  
  const energie = 200 * n_stand + 150 * n_green
  const amortissements = 200 * nbUsines
  const main_oeuvre = 600 * n_stand + 900 * n_green
  
  // Encadrement selon paliers
  let encadrement = 0
  if (nbUsines >= 1 && nbUsines <= 6) encadrement = 200
  else if (nbUsines <= 21) encadrement = 2000
  else encadrement = 3000
  
  const cout_production_total = mp_total + energie + qual_silis + qual_exolis + 
                               dd_silis + dd_exolis + idh + amortissements + 
                               main_oeuvre + encadrement + rd_stand + rd_green
  
  // 3. CUMP et CPDV
  const stock_initial_val = (P0_STOCK_INITIAL_U * P0_STOCK_INITIAL_PU) / 1000
  const unites_disponibles = P0_STOCK_INITIAL_U + prod_silis + prod_exolis
  const cump = unites_disponibles > 0 ? ((stock_initial_val + cout_production_total) / unites_disponibles) * 1000 : 0
  const cpdv = (P0_VENTES_SILIS * cump) / 1000
  
  // 4. Marge brute
  const marge_brute = ca_total - cpdv
  
  // 5. Charges commerciales et administratives
  const charges_admin = getChargesAdmin(nbUsines)
  
  // Stock final PF et co√ªts de stockage
  const stock_final_u = Math.max(0, P0_STOCK_INITIAL_U + prod_silis + prod_exolis - P0_VENTES_SILIS)
  const stock_final_val = (stock_final_u * cump) / 1000
  const ratio_stock = P0_VENTES_PREV > 0 ? stock_final_u / P0_VENTES_PREV : 0
  const taux_stockage = getTauxStockagePF(ratio_stock)
  const cout_stockage_pf = 1000 + stock_final_val * taux_stockage
  const cout_stockage_mp = P0_STOCK_MP_PREV * 0.05
  
  // Logistique (simplifi√© pour P0)
  const cout_logistique_total = 3200 // Valeur calibr√©e P0
  
  const charges_com_admin_total = effort_silis + effort_exolis + com_silis + com_exolis + 
                                 charges_admin + cout_stockage_pf + cout_stockage_mp + 
                                 cout_logistique_total
  
  // 6. R√©sultat op√©rationnel
  const resultat_operationnel = marge_brute - charges_com_admin_total
  
  // 7. Frais financiers
  const frais_financiers = P0_ENCOURS_LT * 0.06 / 4
  
  // 8. R√©sultat avant imp√¥t
  const resultat_avant_impot = resultat_operationnel - frais_financiers
  
  // 9. CALCUL IMP√îTS SELON MODE
  let impots_finaux, mode_label
  
  if (mode_periode === 'P0') {
    impots_finaux = -203  // Valeur fixe P0
    mode_label = 'Imp√¥ts (P0 fixe)'
  } else {
    // Mode P1+ : Calcul IS 32% sur b√©n√©fices
    impots_finaux = resultat_avant_impot > 0 ? resultat_avant_impot * 0.32 : 0
    mode_label = 'Imp√¥ts sur Soci√©t√©s (32%)'
  }
  
  // 10. R√©sultat net
  const resultat_net = resultat_avant_impot - impots_finaux

  // === AFFICHAGE R√âSULTATS ===
  
  document.getElementById('compte_resultat').textContent = 
    `CHIFFRE D'AFFAIRES : ${formatNumber(ca_total)} K‚Ç¨
  - Silis : ${formatNumber(ca_silis)} K‚Ç¨
  - Exolis : ${formatNumber(ca_exolis)} K‚Ç¨

Co√ªt des Produits Vendus : ${formatNumber(cpdv)} K‚Ç¨
MARGE BRUTE : ${formatNumber(marge_brute)} K‚Ç¨

Charges Commerciales et Administratives : ${formatNumber(charges_com_admin_total)} K‚Ç¨
  - Effort Commercial : ${formatNumber(effort_silis + effort_exolis)} K‚Ç¨
  - Communication : ${formatNumber(com_silis + com_exolis)} K‚Ç¨
  - Investissements Qualit√© : ${formatNumber(qual_silis + qual_exolis)} K‚Ç¨
  - Investissements DD : ${formatNumber(dd_silis + dd_exolis)} K‚Ç¨
  - Charges Administratives : ${formatNumber(charges_admin)} K‚Ç¨
  - Stockage & Logistique : ${formatNumber(cout_stockage_pf + cout_stockage_mp + cout_logistique_total)} K‚Ç¨

R√âSULTAT OP√âRATIONNEL : ${formatNumber(resultat_operationnel)} K‚Ç¨
Frais Financiers : ${formatNumber(frais_financiers)} K‚Ç¨
R√âSULTAT AVANT IMP√îT : ${formatNumber(resultat_avant_impot)} K‚Ç¨
${mode_label} : ${formatNumber(impots_finaux)} K‚Ç¨
R√âSULTAT NET : ${formatNumber(resultat_net)} K‚Ç¨`

  // === VALIDATION ===
  
  if (mode_periode === 'P0') {
    const validation_ok = Math.abs(resultat_net + 1331) <= 1
    document.getElementById('validation_gate').innerHTML = 
      `<div class="validation ${validation_ok ? '' : 'error'}">
        <strong>üéØ Validation P0: ${validation_ok ? 'VALID√âE ‚úÖ' : '√âCART D√âTECT√â ‚ö†Ô∏è'}</strong>
        <div class="${validation_ok ? 'ok' : 'error'}">
          R√©sultat Net: ${formatNumber(resultat_net)} K‚Ç¨ (cible: -1,331 K‚Ç¨)
        </div>
      </div>`
  } else {
    const rentable = resultat_net > 0
    const seuil_equilibre = 547.5
    const prix_actuel = prix_silis
    
    document.getElementById('validation_gate').innerHTML = 
      `<div class="validation simulation">
        <strong>üöÄ Simulation P1+ : ${rentable ? 'STRAT√âGIE RENTABLE ‚úÖ' : 'OPTIMISATION N√âCESSAIRE ‚ö†Ô∏è'}</strong>
        <div class="info">
          R√©sultat Net: ${formatNumber(resultat_net)} K‚Ç¨
          ${resultat_avant_impot > 0 ? `(IS pay√©: ${formatNumber(impots_finaux)} K‚Ç¨)` : '(Aucun imp√¥t sur perte)'}
        </div>
        <div style="margin-top:8px;font-size:11px">
          Prix actuel: ${prix_actuel}‚Ç¨ | Seuil √©quilibre: ${seuil_equilibre}‚Ç¨
          ${prix_actuel >= seuil_equilibre ? '‚úÖ' : '‚ö†Ô∏è Prix insuffisant'}
        </div>
      </div>`
  }
}

// Initialisation
document.querySelectorAll('input, select').forEach(element => {
  element.addEventListener('input', recalculer)
  element.addEventListener('change', recalculer)
})

recalculer()
</script>

</body>
</html>
